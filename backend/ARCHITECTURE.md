# ğŸ¨ Architecture Overview

## System Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Frontend (React + TypeScript)               â”‚
â”‚                    (url-guardian-demo-main/)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP/JSON
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Backend                              â”‚
â”‚                    (backend/main.py)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ /check_url   â”‚ /check_html  â”‚ /check_dom   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚              â”‚              â”‚                         â”‚
â”‚         â†“              â†“              â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ RNN Model   â”‚ â”‚Transformer â”‚ â”‚  GCN     â”‚                   â”‚
â”‚  â”‚ (URL)       â”‚ â”‚ (HTML)     â”‚ â”‚ (DOM)    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                â”‚              â”‚                         â”‚
â”‚       â†“                â†“              â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Probability â”‚ â”‚Probability â”‚ â”‚Probabilityâ”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                â”‚              â”‚                         â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                        â†“                                        â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                  â”‚  Ensemble    â”‚                               â”‚
â”‚                  â”‚  Averaging   â”‚                               â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                         â†“                                       â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                  â”‚ Final Prediction                             â”‚
â”‚                  â”‚ + Confidence â”‚                               â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
                    [JSON Response]
                    probability: 0.75
                    label: PHISHING
                    confidence: 0.85
```

## Model Pipeline Details

### 1ï¸âƒ£ URL Model (RNN)

```
Input:  "https://verify-paypal.com/login?session=123"
  â†“
Preprocessing:
  â”œâ”€ Load stoi (charâ†’int mapping)
  â”œâ”€ Encode each char: {'h':72, 't':116, ...}
  â”œâ”€ Pad to 256 chars
  â””â”€ Return: [72, 116, 116, 112, ...]
  
  â†“
RNN Forward:
  â”œâ”€ Embedding: (1, 256) â†’ (1, 256, 64)
  â”œâ”€ GRU: (1, 256, 64) â†’ hidden (2, 1, 128) [bidirectional]
  â”œâ”€ Concat: (2, 1, 128) â†’ (1, 256)
  â”œâ”€ Head: (1, 256) â†’ (1, 128) â†’ (1, 2) [logits]
  â””â”€ Softmax: (1, 2) â†’ [0.25, 0.75]
  
  â†“
Output: probability=0.75, label="PHISHING"
```

### 2ï¸âƒ£ HTML Model (Transformer)

```
Input:  "<html><body><form action='http://attacker.com'></form></body></html>"
  â†“
Preprocessing (Multi-window):
  â”œâ”€ Encode to UTF-8 bytes
  â”œâ”€ Split into windows (max 2048 tokens, 50% overlap)
  â”œâ”€ For each window:
  â”‚  â”œâ”€ Prepend [CLS] token (ID=257)
  â”‚  â”œâ”€ Append [SEP] token (ID=258)
  â”‚  â””â”€ Pad to 2048 with PAD tokens (ID=256)
  â””â”€ Result: 4 windows of (2048,)
  
  â†“
Transformer Forward (per window):
  â”œâ”€ Embedding: (1, 2048) â†’ (1, 2048, 192)
  â”œâ”€ Add positional encoding: + (1, 2048, 192)
  â”œâ”€ 4-layer Transformer encoder
  â”œâ”€ LayerNorm: (1, 2048, 192)
  â”œâ”€ Global avg pooling: (1, 2048, 192) â†’ (1, 192)
  â”œâ”€ Dropout: (1, 192) â†’ (1, 192)
  â””â”€ Head: (1, 192) â†’ (1, 2) [logits]
  
  â†“
Average 4 windows:
  â””â”€ Softmax: (4, 2) â†’ mean â†’ [0.38, 0.62]
  
  â†“
Output: probability=0.62, label="PHISHING"
```

### 3ï¸âƒ£ DOM Model (GCN)

```
Input DOM Record:
{
  "nodes": [
    {"tag": "html"},
    {"tag": "body"},
    {"tag": "form", "attrs": {"action": "http://..."}},
    {"tag": "input", "attrs": {"type": "password"}}
  ],
  "edges": [[0,1], [1,2], [2,3]]
}

  â†“
Preprocessing:
  â”œâ”€ Build node features (70-dim):
  â”‚  â”œâ”€ Tag one-hot: 64 dims (0-63 for tag vocab)
  â”‚  â”œâ”€ Degree log: 1 dim
  â”‚  â”œâ”€ has_href: 1 dim
  â”‚  â”œâ”€ has_src: 1 dim
  â”‚  â”œâ”€ is_input: 1 dim
  â”‚  â”œâ”€ is_password: 1 dim
  â”‚  â””â”€ text_len_log: 1 dim
  â”‚
  â”œâ”€ Node features matrix: (4, 70)
  â”‚
  â””â”€ Build sparse adjacency:
     â”œâ”€ Add edges (bidirectional + self-loops)
     â”œâ”€ Normalize: D^(-1/2) A D^(-1/2)
     â””â”€ Sparse COO format: (4, 4)
  
  â†“
GCN Forward:
  â”œâ”€ Layer 1: SparseGCN
  â”‚  â”œâ”€ Linear: (4, 70) â†’ (4, 128)
  â”‚  â”œâ”€ Sparse MM with A: apply normalized adjacency
  â”‚  â”œâ”€ ReLU activation
  â”‚  â””â”€ Output: (4, 128)
  â”‚
  â”œâ”€ Layer 2: SparseGCN
  â”‚  â”œâ”€ Linear: (4, 128) â†’ (4, 128)
  â”‚  â”œâ”€ Residual: + Linear((4, 70)â†’(4, 128))
  â”‚  â””â”€ Output: (4, 128)
  â”‚
  â”œâ”€ LayerNorm: (4, 128) â†’ (4, 128)
  â”‚
  â”œâ”€ Graph-level readout:
  â”‚  â”œâ”€ Mean pooling: (4, 128) â†’ (128,)
  â”‚  â”œâ”€ Max pooling: (4, 128) â†’ (128,)
  â”‚  â””â”€ Concat: (256,)
  â”‚
  â”œâ”€ Classification head: (256,) â†’ (2)
  â””â”€ Logits: [0.42, 0.58]
  
  â†“
Output: probability=0.58, label="PHISHING"
```

## Data Flow Through Backend

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Request                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POST /api/check_url_fast                                   â”‚
â”‚  {"url": "https://example.com"}                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Validate Input       â”‚
          â”‚ - Check not empty    â”‚
          â”‚ - Check format       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Load Preprocessor    â”‚
          â”‚ - rnn_url_vocab.json â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Preprocess Input     â”‚
          â”‚ - Char encoding      â”‚
          â”‚ - Padding            â”‚
          â”‚ - Tensor creation    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Inference            â”‚
          â”‚ - GPU/CPU forward    â”‚
          â”‚ - Softmax            â”‚
          â”‚ - Extract prob       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Load Threshold       â”‚
          â”‚ - rnn_best_threshold â”‚
          â”‚   .json              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Classify             â”‚
          â”‚ prob >= thr?         â”‚
          â”‚ - Yes â†’ PHISHING     â”‚
          â”‚ - No  â†’ BENIGN       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Compute Confidence   â”‚
          â”‚ |prob - 0.5| / 0.5   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Response (JSON)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  {                                                          â”‚
â”‚    "probability": 0.75,                                     â”‚
â”‚    "label": "PHISHING",                                     â”‚
â”‚    "confidence": 0.85                                       â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Dependencies

```
main.py
â”œâ”€â”€ config.py
â”‚   â””â”€â”€ (paths to CKPT files)
â”‚
â”œâ”€â”€ models_src/
â”‚   â”œâ”€â”€ inference.py
â”‚   â”‚   â”œâ”€â”€ architectures.py
â”‚   â”‚   â”‚   â””â”€â”€ torch (external)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ preprocessing.py
â”‚   â”‚       â”œâ”€â”€ numpy (external)
â”‚   â”‚       â”œâ”€â”€ json (stdlib)
â”‚   â”‚       â””â”€â”€ math (stdlib)
â”‚   â”‚
â”‚   â””â”€â”€ preprocessing.py (used directly)
â”‚
â””â”€â”€ FastAPI/Pydantic (external)
```

## Performance Characteristics

```
Model          Input Size     Processing    Total Time   Memory
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
URL (RNN)      256 tokens     20ms          20-50ms      ~100MB
HTML (Trans)   2048 tokens    300ms         100-500ms    ~500MB
DOM (GCN)      variable       300ms         100-1000ms   ~1GB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ensemble       all 3          combined      300-1500ms   ~1.5GB
```

## Configuration Hierarchy

```
config.py
â”œâ”€â”€ Paths (from environment)
â”‚   â”œâ”€â”€ BACKEND_ROOT â†’ __file__.parent
â”‚   â”œâ”€â”€ PROJECT_ROOT â†’ BACKEND_ROOT.parent
â”‚   â””â”€â”€ CKPT_DIR â†’ PROJECT_ROOT / "CKPT"
â”‚
â”œâ”€â”€ Model Configs
â”‚   â”œâ”€â”€ RNN_CONFIG
â”‚   â”‚   â”œâ”€â”€ vocab_size: 87
â”‚   â”‚   â”œâ”€â”€ emb_dim: 64
â”‚   â”‚   â”œâ”€â”€ hidden_dim: 128
â”‚   â”‚   â””â”€â”€ max_len: 256
â”‚   â”‚
â”‚   â”œâ”€â”€ TRANSFORMER_CONFIG
â”‚   â”‚   â”œâ”€â”€ vocab_size: 259
â”‚   â”‚   â”œâ”€â”€ d_model: 192
â”‚   â”‚   â”œâ”€â”€ n_head: 6
â”‚   â”‚   â”œâ”€â”€ n_layers: 4
â”‚   â”‚   â””â”€â”€ max_len: 2048
â”‚   â”‚
â”‚   â””â”€â”€ GNN_CONFIG
â”‚       â”œâ”€â”€ tag_topk: 64
â”‚       â”œâ”€â”€ max_nodes: 2048
â”‚       â””â”€â”€ hidden_dim: 128
â”‚
â”œâ”€â”€ Device
â”‚   â””â”€â”€ DEVICE = "cuda" or "cpu"
â”‚
â””â”€â”€ API Configs
    â”œâ”€â”€ API_HOST: "0.0.0.0"
    â”œâ”€â”€ API_PORT: 8000
    â””â”€â”€ API_WORKERS: 1
```

## Request/Response Cycle

```
Timeline for check_url_fast("https://example.com"):

t=0ms    â””â”€ Client sends HTTP POST request
t=1ms    â””â”€ FastAPI route handler receives request
t=2ms    â””â”€ Pydantic validates input schema
t=3ms    â””â”€ Extract URL from JSON
t=4ms    â””â”€ Load vocabulary (cached after first load)
t=5ms    â””â”€ Encode URL string â†’ int array
t=6ms    â””â”€ Convert to torch tensor
t=7ms    â””â”€ Transfer to GPU/CPU
t=8ms    â””â”€ Forward pass through GRU (main compute)
t=25ms   â””â”€ Softmax + probability extraction
t=26ms   â””â”€ Load threshold (cached)
t=27ms   â””â”€ Classify & compute confidence
t=28ms   â””â”€ Serialize response to JSON
t=30ms   â””â”€ Send response to client

Total: ~30ms (20-50ms typical)
```

---

**This architecture provides a robust, scalable phishing detection system! ğŸ›¡ï¸**
